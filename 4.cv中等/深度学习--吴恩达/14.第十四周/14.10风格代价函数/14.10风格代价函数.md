#14.10风格代价函数

###风格代价函数 (Style Cost Function)
在上节视频中，我们学习了如何为神经风格迁移定义内容代价函数，这节课我们来了解风格代价函数。那么图片的风格到底是什么意思呢？

![](https://cdn.jsdelivr.net/gh/tj-messi/picture/20241008134232.png)

这么说吧，比如你有这样一张图片，你可能已经对这个计算很熟悉了，它能算出这里是否含有不同隐藏层。现在你选择了某一层 l ll （编号1），比如这一层去为图片的风格定义一个深度测量，现在我们要做的就是将图片的风格定义为 l ll 层中各个通道之间激活项的相关系数

![](https://cdn.jsdelivr.net/gh/tj-messi/picture/20241008134547.png)

我来详细解释一下，现在你将 l ll 层的激活项取出，这是个 n H ∗ n W ∗ n c n_H*n_W*n_cn 
H
​
 ∗n 
W
​
 ∗n 
c
​
  的激活项，它是一个三维的数据块。现在问题来了，如何知道这些不同通道之间激活项的相关系数呢？

为了解释这些听起来很含糊不清的词语，现在注意这个激活块，我把它的不同通道渲染成不同的颜色。在这个例子中，假如我们有5个通道为了方便讲解，我将它们染成了五种颜色。一般情况下，我们在神经网络中会有许多通道，但这里只用5个通道，会更方便我们理解

![](https://cdn.jsdelivr.net/gh/tj-messi/picture/20241008134945.png)

为了能捕捉图片的风格，你需要进行下面这些操作，首先，先看前两个通道，前两个通道（编号1、2）分别是图中的红色和黄色部分，那我们该如何计算这两个通道间激活项的相关系数呢？

![](https://cdn.jsdelivr.net/gh/tj-messi/picture/20241008135005.png)

举个例子，在视频的左下角在第一个通道中含有某个激活项，第二个通道也含有某个激活项，于是它们组成了一对数字（编号1所示）。然后我们再看看这个激活项块中其他位置的激活项，它们也分别组成了很多对数字（编号2，3所示），分别来自第一个通道，也就是红色通道和第二个通道，也就是黄色通道。现在我们得到了很多个数字对，当我们取得这两个 n H ∗ n W n_H*n_Wn 
H
​
 ∗n 
W
​
  的通道中所有的数字对后，现在该如何计算它们的相关系数呢？它是如何决定图片风格的呢

![](https://cdn.jsdelivr.net/gh/tj-messi/picture/20241008135121.png)

我们来看一个例子，这是之前视频中的一个可视化例子，它来自一篇论文，作者是Matthew Zeile和Rob Fergus 我之前有提到过。我们知道，这个红色的通道（编号1）对应的是这个神经元，它能找出图片中的特定位置是否含有这些垂直的纹理（编号3），而第二个通道也就是黄色的通道（编号2），对应这个神经元（编号4），它可以粗略地找出橙色的区域。什么时候两个通道拥有高度相关性呢？如果它们有高度相关性，那么这幅图片中出现垂直纹理的地方（编号2），那么这块地方（编号4）很大概率是橙色的。如果说它们是不相关的，又是什么意思呢？显然，这意味着图片中有垂直纹理的地方很大概率不是橙色的。而相关系数描述的就是当图片某处出现这种垂直纹理时，该处又同时是橙色的可能性。

相关系数这个概念为你提供了一种去测量这些不同的特征的方法，比如这些垂直纹理，这些橙色或是其他的特征去测量它们在图片中的各个位置同时出现或不同时出现的频率。

如果我们在通道之间使用相关系数来描述通道的风格，你能做的就是测量你的生成图像中第一个通道（编号1）是否与第二个通道（编号2）相关，通过测量，你能得知在生成的图像中垂直纹理和橙色同时出现或者不同时出现的频率，这样你将**能够测量生成的图像的风格与输入的风格图像的相似程度**。

![](https://cdn.jsdelivr.net/gh/tj-messi/picture/20241008135448.png)

现在我们来证实这种说法，对于这两个图像，也就是风格图像与生成图像，你需要计算一个风格矩阵，说得更具体一点就是用 l ll 层来测量风格

![](https://cdn.jsdelivr.net/gh/tj-messi/picture/20241008135508.png)

![](https://cdn.jsdelivr.net/gh/tj-messi/picture/1728366932771.png)

![](https://cdn.jsdelivr.net/gh/tj-messi/picture/20241008140007.png)

![](https://cdn.jsdelivr.net/gh/tj-messi/picture/1728367237739.png)

![](https://cdn.jsdelivr.net/gh/tj-messi/picture/20241008140308.png)

![](https://cdn.jsdelivr.net/gh/tj-messi/picture/1728367411623.png)

![](https://cdn.jsdelivr.net/gh/tj-messi/picture/20241008140443.png)

![](https://cdn.jsdelivr.net/gh/tj-messi/picture/1728367536149.png)

![](https://cdn.jsdelivr.net/gh/tj-messi/picture/20241008140625.png)

![](https://cdn.jsdelivr.net/gh/tj-messi/picture/1728367611225.png)

![](https://cdn.jsdelivr.net/gh/tj-messi/picture/20241008140702.png)

![](https://cdn.jsdelivr.net/gh/tj-messi/picture/1728367635236.png)