#Uni3DETR: Unified 3D Detection Transformer

##1.abstract
提出了Uni3DETR，一种统一的3D检测器，在同一框架内解决室内和室外3D检测问题。

![](https://cdn.jsdelivr.net/gh/tj-messi/picture/1727245288574.png)

##2.introduction
基于点云的三维目标检测旨在预测给定点集的真实场景的定向三维边界框和语义标签

室内三维探测器[38,70,62,58]通常采用“分组、聚类和分类”的方式

室外探测器[64,24,52,49]通常将特征转换为二维鸟瞰图(BEV)空间

开发统一的3D探测器的关键挑战在于室内和室外环境中__收集的点云数据的巨大差异__。一般来说，室内场景是杂乱的，各种物体紧密而密集，占据了场景的大部分。相比之下，室外场景中的物体较小且稀疏，背景点在收集的点云中占主导地位。

采用三维稀疏卷积和密集卷积相结合的混合结构进行特征提取。纯3D建筑避免了室内点云过度的高度压缩。同时，稀疏卷积防止了大范围室外数据的巨大内存消耗，密集卷积缓解了稀疏室外点的中心特征缺失问题。

我们利用变压器[57]进行三维目标检测。基于变压器的检测器中的集对集预测方法[4,77]直接考虑预测对象和ground-truth标签

![](https://cdn.jsdelivr.net/gh/tj-messi/picture/uni3detr.png)

##3.uni3Detr

###3.1 Unified 3D Detection Transformer for Diverse Scenes

####3d-feature
1. 利用一系列的3D稀疏卷积层对3D特征进行编码和下采样，以避免大范围户外场景的过载内存消耗

2. 将提取的稀疏特征转换为密集特征，并应用三维密集卷积进行进一步的特征处理。密集卷积缓解了中心点的特征缺失问题。

####3d-transformer

1.  对象查询：将3D空间中的3D点视为查询，采用类似DETR的架构，使用一组可学习的对象查询来并行地预测多个目标。

2.  混合查询点：Uni3DETR引入混合查询点机制，结合可学习查询点和非可学习查询点（通过FPS得到），以充分利用全局和局部信息。这种机制在室内外场景中均表现出色。

	2-1 可学习查询点（Learnable Query Points）
	定义：可学习查询点是模型在训练过程中通过反向传播算法自动优化的查询点。它们能够捕捉目标物体的局部特征，对于检测场景中的目标细节尤为有效。
	特点：随着训练的进行，可学习查询点会逐渐聚焦于物体实例，帮助模型更好地定位目标。然而，它们可能无法全面捕捉场景的全局信息，特别是在物体稀疏或遮挡的情况下。

	2-2 非可学习查询点（Non-learnable Query Points）
	定义：非可学习查询点通常是通过某种采样策略（如最远点采样）从输入点云中预先确定的点。它们在训练过程中保持不变，不参与梯度下降优化。
	特点：非可学习查询点能够覆盖整个场景，提供关于场景全局结构的丰富信息。它们有助于模型在物体稀疏或遮挡时仍能进行有效的检测，因为它们不依赖于物体的局部特征。

3.  交叉注意力：通过交叉注意力机制，使对象查询与特征体素进行交互，从而生成目标的类别和位置预测。

![](https://cdn.jsdelivr.net/gh/tj-messi/picture/1727260241149.png)

####混合查询点

查询点的混合物最终由三个组成:__P = {Pl, Pnl, Pnlv}__。我们按照[5]在转换器解码器中对混合查询点执行组明智的自关注，其中这三种查询点彼此不交互。经过变压器解码器后，__分别预测三组预测的3D盒{bbl, bbnl, bbnlv}__。我们使用匈牙利匹配算法[23]对每组3D盒子独立进行一对一的分配，并计算相应的训练损失来监督检测变压器的学习

###3.2解耦IoU

一个三维盒子通常表示为:bb = (x, y, z, w, l, h， θ)，其中(x, y, z)为中心，(w, l, h)为大小，θ为旋转。两个三维盒子bb1和bb2之间通常的__三维IoU__[72]计算公式为

![](https://cdn.jsdelivr.net/gh/tj-messi/picture/23fecdd18aee7aaa317a4e2f3cfe6fbb.png)

由式2可知，三维IoU的计算一般由两个空间组成:xy空间为边界框区域，包含x、y、w、l、θ变量;z空间为框高。

这两个空间在3D借据中相乘。在监督网络时，这两个空间的梯度是耦合在一起的，在一个空间中进行优化会干扰另一个空间，使训练过程不稳定。

因此需要解除耦合

![](https://cdn.jsdelivr.net/gh/tj-messi/picture/1727274644425.png)

解耦后的__IoU__是xy空间和z空间中__IoU__的平均值。在求和运算下，两项的梯度保持分离独立，避免了任何耦合效应。

保持了两个空间梯度分立，避免耦合效应
根据这个IoUde可以计算新的分类损失

![](https://cdn.jsdelivr.net/gh/tj-messi/picture/1727275211423.png)

目标概率（ a^ t）、平衡参数（α）、类别标签（c）、交并比（IoU）以及预测概率（ p^​），并引入了一个指数因子（γ）来调整预测概率对损失的影响。

